{% extends 'admin/master.html' %}

{% block brand %}
    <style>.container {width: 96%;}</style>
    <h4 id="brand" style="width:200px"> * Flask Tracker *</h4> <small>ver.:  {{ version }} </small>
{% endblock %}

{% block access_control %}
{% if current_user.is_authenticated %}
<div class="btn-group pull-right">
    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="icon-user"></i> {{ current_user.login }} <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        <li><a href="{{ url_for('admin.logout') }}">Log out</a></li>
    </ul>
</div>
{% endif %}
{% endblock %}

{% block body %}

<style>
    .container {width: 96%;}
    .page-alfa {
        background-color: #FFF7DD;'
    }
</style>

{{ super() }}

    <div>
        {% if current_user.is_authenticated %}
            <div> <h4>Home - {{ current_user.name }}</h4> </div>
        {% else %}
        <form method="POST" action="">
            {{ form.hidden_tag() if form.hidden_tag }}
            {% for f in form if f.type != 'CSRFTokenField' %}
            <div>
            {{ f.label }}
            {{ f }}
            {% if f.errors %}
            <ul>
                {% for e in f.errors %}
                <li>{{ e }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            </div>
            {% endfor %}
            <button class="btn" type="submit">Submit</button>
        </form>
        {{ link | safe }}
        {% endif %}
    </div>

{% if current_user.is_authenticated %}

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-0">
            </div>
            <div class="col-sm-3 table-responsive page-alfa">

            {% for (title, filtered_views) in (('task views', task_filtered_views), ('worked hours views', worktime_filtered_views)) %}
            
                <table class="table table-striped table-bordered table-hover model-list">
                    <thead>
                        <tr><th class="col-md-4">{{ title }}</th></tr>            
                    </thead>   

                    {% for a, b in filtered_views %}
                    <tr>
                        <td class="col-md-1"> 
                            <a href="{{ b }}">{{ a }}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </table>            

            {% endfor %}

            </div>
            <div class="col-sm-2 table-responsive">
                <label for="add_task_button"> Add a New task </label>
                <div>
                    <button name="add_task_button" class="form-control btn-primary" onclick="window.open('/task/new/');"> New Task </button>
                </div>

                <hr></hr>

                <label for="add_work_hrs_form"> Add Working Hours </label>
                <form name="add_work_hrs_form" action="/add_a_working_time_slot" method='GET' id="add_work_hrs_form">
                <label for="selected_task"> Task: </label>
                    <select class="form-control" name="selected_task">
                        {% for t in assigned_task_names %}
                        <option name="{{ t }}">{{ t }}</option>
                        {% endfor %}
                    </select>
                    <label for="hours_to_add"> hours: </label>
                    <input class="form-control" name="hours_to_add" id="hours_to_add" type="number" step="0.5" value="0"></input>
                    <label for="date"> date: </label>
                    <input class="form-control" name="date" type="date" value="" id="input_date"></input>
                    <button class="form-control btn-primary" type="submit" onclick="add_hours_btn_clicked();">add</button>
                </form>

            </div>
        </div>
        <hr></hr>
        <div class="row">
            <div class="col-sm-2 table-responsive">
                <button class="form-control btn-primary" onclick="reports_btn_clicked();">Reports</button>
            </div>
        </div>
    </div>

<script>

    var reports_btn_clicked = function(){
        var url = "/report";
        var title = "Report";
        var options = "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,zoomable=yes,top="+(200)+",left="+(240);
        var win = window.open(url, title, options);
    }
    var add_hours_btn_clicked = function(){
        var hours_to_add = document.getElementById('hours_to_add').value;
        if (hours_to_add <= 0) {
            document.getElementById('add_work_hrs_form').action = "javascript:void(0)";
            alert("invalid number of hours");
        } else {
            if (confirm('confirm adding hours?')) {
                document.getElementById('add_work_hrs_form').action = "/add_a_working_time_slot";
            } else {
                document.getElementById('add_work_hrs_form').action = "javascript:void(0)";
            }
        }
    }

    var init = function(){
        document.getElementById('input_date').valueAsDate = new Date();
    }
    init();

</script>

{% endif %}

{% endblock body %}
