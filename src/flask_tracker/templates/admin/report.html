
<!DOCTYPE html>
<html>
<head>
<title>Reports</title>

  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content=""/>
  <meta name="author" content=""/>
  <link href="/static/admin/bootstrap/bootstrap3/swatch/default/bootstrap.min.css?v=3.3.5" rel="stylesheet"/>
  <link href="/static/admin/bootstrap/bootstrap3/css/bootstrap-theme.min.css?v=3.3.5" rel="stylesheet"/>
  <link href="/static/admin/admin/css/bootstrap3/admin.css?v=1.1.1" rel="stylesheet"/>
  <link href="/static/admin/admin/css/bootstrap3/submenu.css" rel="stylesheet"/>

  <script src="/static/lib/js/jquery.min.js"></script>
  <script src="/static/lib/js/popper.min.js"></script>
  <script src="/static/lib/js/bootstrap.min.js"></script>

<style>
    body {
        padding-top: 4px;
    }
    .container {width: 96%;}
    .page-alfa {
        background-color: #FFF7DD;'
    }
</style>
<script>

    var refresh_report_table = function(data, status, xhr){
        var results = data.results;
        var time_s = data.time_s;
        var title = data.report_title;
        document.createElement("report_title").innerHTML = title;
        console.log("refresh_report_table() results.length: " + results.length);
        console.log("refresh_report_table() results: " + JSON.stringify(results));
        var report_table = document.getElementById('report_table')
        var n = report_table.rows.length;
        for (var i = 0; i < n; i++) {
            report_table.deleteRow(0);
        }
        for (var i = 0; i < results.length; i++) {
            var tr = report_table.insertRow();
            for (var j = 0; j < results[i].length; j++) {
                var td = document.createElement("td");
                td.innerHTML = results[i][j];
                tr.appendChild(td);
//~                 console.log("refresh_report_table() i, j: " + i +', ' +j);
//~                 console.log("refresh_report_table() result[i][j]: " + result[i][j]);
            }
        }
        console.log("refresh_report_table() report_table.rows.length: " + report_table.rows.length);
    }

    var refresh_btn_clicked = function(){
        var data = {};
        data.selected_project = document.getElementById('selected_project').value;
        data.selected_order = document.getElementById('selected_order').value;
        data.selected_user = document.getElementById('selected_user').value;
        data.since = document.getElementById('since').value;
        $.ajax({
            data: data,
            dataType: "json",
            success: refresh_report_table,
            error: refresh_report_table,
            contentType: "application/json",
            timeout: 5000,
            url: '/report',
            method: 'POST'
        });
    };

    var init = function(){
        var d = new Date();
        var prevMonday = new Date();
        prevMonday.setDate(d.getDate() - d.getDay() + 1);
        document.getElementById('since').valueAsDate = prevMonday;
    };

</script>
</head>
<body>

{% if current_user.is_authenticated %}


    <div class="container-fluid">
        <div> <h4>Report - {{ current_user.name }}</h4> </div>
        <div class="col-sm-3 table-responsive page-alfa">
            <label for="report_form"> Report Total Worked Hours</label>
            <form name="report_form" action="/report" method='POST'>
                <label for="selected_project"> Project: </label>
                <select class="form-control" id="selected_project" name="selected_project">
                    <option name="any">any</option>
                    {% for p in projects %}
                    <option name="{{ p }}">{{ p }}</option>
                    {% endfor %}
                </select>
                <label for="selected_order"> Order: </label>
                <select class="form-control" id="selected_order" name="selected_order">
                    <option name="any">any</option>
                    {% for o in orders %}
                    <option name="{{ o }}">{{ o }}</option>
                    {% endfor %}
                </select>
                <label for="selected_user"> User: </label>
                <select class="form-control" id="selected_user" name="selected_user">
                    <option name="any">any</option>
                    {% for o in users %}
                    <option name="{{ o }}">{{ o }}</option>
                    {% endfor %}
                </select>
                <label for="since"> since: </label>
                <input type="date" class="form-control" id="since" name="since">
                </input>
            </form>
            <p>
                <div class="form-control btn-primary" onclick="refresh_btn_clicked();">GO</div>
                <hr></hr>
                <a href="/" class="form-control btn-primary">Exit</a> 
            </p>
        </div>

    <div class="row">
            <div class="col-sm-3 table-responsive">
                <h4 id="report_title">{{ report_title }}</h4>
                <table class="table table-striped table-bordered table-hover model-list" id="report_table">
                </table>            
            </div>
        </div>
    </div>

<script>
    init();
</script>

{% endif %}

</body>
</html>

